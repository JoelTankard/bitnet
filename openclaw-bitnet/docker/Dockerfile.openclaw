# OpenClaw with BitNet Provider Dockerfile
# Runs OpenClaw gateway configured to use BitNet as the LLM backend

FROM node:22-bookworm-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    git \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Create app user for security
RUN useradd -m -s /bin/bash openclaw

# Install OpenClaw globally
RUN npm install -g openclaw@latest

# Create necessary directories
RUN mkdir -p /home/openclaw/.openclaw /app && \
    chown -R openclaw:openclaw /home/openclaw /app

# Switch to app user
USER openclaw
WORKDIR /app

# Copy configuration
COPY --chown=openclaw:openclaw config/ /home/openclaw/.openclaw/
COPY --chown=openclaw:openclaw providers/ /app/providers/

# Environment variables
ENV NODE_ENV=production
ENV OPENCLAW_CONFIG_DIR=/home/openclaw/.openclaw
ENV BITNET_API_URL=http://bitnet-server:8080

# Expose OpenClaw gateway port
EXPOSE 18789

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
    CMD curl -f http://localhost:18789/health || exit 1

# Entrypoint
COPY --chown=openclaw:openclaw docker/entrypoint-openclaw.sh /entrypoint.sh
USER root
RUN chmod +x /entrypoint.sh
USER openclaw

ENTRYPOINT ["/entrypoint.sh"]
